{% extends 'userbase.html' %}
{% block title %}InternLink - Manage Users{% endblock %}
{% set active_page = 'users' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <a href="{{ url_for('admin_create_user') }}" class="btn btn-success">
        <i class="fas fa-user-plus me-1"></i>Create User
    </a>
</div>

<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">
            <i class="fas fa-search me-2"></i>Search Users
        </h5>
        <form method="GET" action="{{ url_for('admin_users') }}">
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="search_name" class="form-label">Full Name</label>
                    <input type="text" class="form-control" id="search_name" name="search_name" 
                           value="{{ search_name }}" placeholder="Search by name">
                </div>
                <div class="col-md-4">
                    <label for="search_role" class="form-label">Role</label>
                    <select class="form-select" id="search_role" name="search_role">
                        <option value="">All Roles</option>
                        <option value="student" {% if search_role == 'student' %}selected{% endif %}>Student</option>
                        <option value="employer" {% if search_role == 'employer' %}selected{% endif %}>Employer</option>
                        <option value="admin" {% if search_role == 'admin' %}selected{% endif %}>Admin</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="search_status" class="form-label">Status</label>
                    <select class="form-select" id="search_status" name="search_status">
                        <option value="">All Statuses</option>
                        <option value="active" {% if search_status == 'active' %}selected{% endif %}>Active</option>
                        <option value="inactive" {% if search_status == 'inactive' %}selected{% endif %}>Inactive</option>
                    </select>
                </div>
            </div>
            <div class="mt-3">
                <button type="submit" class="btn btn-primary me-2">
                    <i class="fas fa-search me-1"></i>Search
                </button>
                <a href="{{ url_for('admin_users') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-times me-1"></i>Clear
                </a>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Name</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                        <tr>
                            <td>{{ user.full_name }}</td>
                            <td>{{ user.username }}</td>
                            <td>{{ user.email }}</td>
                            <td>
                                <span class="badge bg-{% if user.role == 'admin' %}danger{% elif user.role == 'employer' %}success{% else %}primary{% endif %}">
                                    {{ user.role.title() }}
                                </span>
                            </td>
                            <td>
                                <span class="badge bg-{% if user.status == 'active' %}success{% else %}secondary{% endif %}">
                                    {{ user.status.title() }}
                                </span>
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <a href="{{ url_for('admin_view_user', user_id=user.user_id) }}" 
                                       class="btn btn-outline-primary">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    {% if user.user_id != session['user_id'] %}
                                        <a href="{{ url_for('admin_toggle_user_status', user_id=user.user_id) }}" 
                                           class="btn btn-outline-{% if user.status == 'active' %}warning{% else %}success{% endif %}"
                                           onclick="return confirm('Are you sure you want to change this user\'s status?')">
                                            <i class="fas fa-{% if user.status == 'active' %}pause{% else %}play{% endif %}"></i>
                                        </a>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if not users %}
            <div class="text-center py-4">
                <i class="fas fa-users fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">No users found</h5>
                <p class="text-muted">Try adjusting your search criteria.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
